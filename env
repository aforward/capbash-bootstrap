#!/bin/bash

if [[ -e ./submodules/bootstrap/logging ]]; then
  source ./submodules/bootstrap/logging
else
  source /usr/local/bin/logging
fi

if [[ `uname` == "Darwin" ]]; then
  export OS=mac
  export SED_I="sed -i .deleteme"
elif [[ "`lsb_release -d | grep Ubuntu`" != "" ]]; then
  export OS=ubuntu
  export SED_I="sed -i"
elif [[ "`lsb_release -d | grep Mint`" != "" ]]; then
  export OS=ubuntu
  export SED_I="sed -i"
elif [[ "`lsb_release -d | grep \"Red Hat\"`" != "" ]]; then
  export OS=redhat
  export SED_I="sed -i"
elif [[ "`lsb_release -d | grep \"CentOS\"`" != "" ]]; then
  export OS=centos
  export SED_I="sed -i"
else
  export OS=unknown
  export SED_I="sed -i"
fi

debug "Exporting \$OS=$OS"

ENV=${ENV-$OS}
if [[ ! -z "$ENV" ]] && [[ -e "./assets/env/$ENV" ]]; then
  debug "Including ENV specific env ($ENV)"
  . ./assets/env/$ENV
else
  OS_ENV=./assets/env/$OS
  if [[ -e $OS_ENV ]]; then
    debug "Including OS specific env ($OS_ENV)"
    . $OS_ENV
  fi
fi